{% extends 'base.html' %}

{% block title %}Artm Online | {{document.title}} {% endblock %}

{% block content %}
	<h1> {{document.title}} </h1>  
	{{document.snippet}}

	<ul class="nav nav-tabs">
	{% if lines %}
		<li class="active"><a>Text</a></li> 
		<li><a href="#" onclick="window.location.replace('/visual/document?id={{document.id}}&mode=bow')">Bag of words</a></li>
	{% else %}
		<li><a href="#" onclick="window.location.replace('/visual/document?id={{document.id}}')">Text</a></li> 
		<li  class="active"><a>Bag of words</a></li>
	{% endif %}
	</ul> 
	{% if lines %}
		{% autoescape off %}
		{% for paragraph in lines %}
			<p>
				{{paragraph}}
			</p>
		{% endfor %}
		{% endautoescape %}
	{% elif bow %}
		{% autoescape off %}{{bow}}{% endautoescape %}
	{% endif %}
{% endblock %}
 

{% block right %}
	<div>
		<h4>Meta</h4>
		Dataset: <a href="/dataset?dataset={{document.dataset.text_id}}">{{document.dataset}}</a><br>
		Time: {{document.time}}<br>  
		Original: <a href = {{document.url}}>link</a>
		<br>
		iid: {{document.index_id}}
		
	</div>
	<hr>
	<div>
		<h4>Topic distribution</h4>
		<div id = "pieChart2" align = "center" ></div>
		
		{% for topic in topics %}
		<span id ="square{{topic.i}}">âˆŽ</span>
		<a href = "{{topic.url}}">{{topic.title}}</a>
		</br>
		{% endfor %}
	</div>
	<hr>
	<div> 
		<h4>Related documents</h4>
		{% for rel_doc in related_documents %}
			<a href = "/visual/document?id={{rel_doc.id}}" >{{rel_doc.title}}</a>
			<br>
		{% endfor %}
	</div>
{% endblock %}

{% block javascript %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/static/js/d3.v3.min.js"></script>
<script src="/static/js/d3pie.min.js"></script>
 
<script type="text/javascript">

	try{
		document.getElementById("square0").style.color = THEME_pieColor0;
		document.getElementById("square1").style.color = THEME_pieColor1;
		document.getElementById("square2").style.color = THEME_pieColor2;
		document.getElementById("square3").style.color = THEME_pieColor3;
		document.getElementById("square4").style.color = THEME_pieColor4;
	} catch (e) {;}
	
	var styleSheets = window.document.styleSheets;
	
	var pie = new d3pie("pieChart2", {
		"header": {
			"title": {
				"fontSize": 22,
				"font": "verdana"
			},
			"subtitle": {
				"color": "#999999",
				"fontSize": 10,
				"font": "verdana"
			},
			"titleSubtitlePadding": 12
		},
		"footer": {
			"color": "#999999",
			"fontSize": 11,
			"font": "open sans",
			"location": "bottom-center"
		},
		"size": {
			"canvasHeight": 200,
			"canvasWidth": 200,
			"pieOuterRadius": "100%"
		},
		"data": {
			"smallSegmentGrouping": {
				"enabled": true,
				"value": 5
			},
			"content": [
				{% for topic in topics %}
				{
					"label": "{{topic.topic.title}}",
					"value": {{topic.weight}},
					"url": "{{topic.url}}",
					"color" : THEME_pieColor{{topic.i}},
				}, 
				{% endfor %}
			]
		},
		"labels": {
			"outer": {
				"format": "none",
				"pieDistance": 32
			},
			"inner": {
				"hideWhenLessThanPercentage": 5,
			},
			"mainLabel": {
				"font": "verdana"
			},
			"percentage": {
				"color": "#000000",
				"font": "verdana",
				"decimalPlaces": 1
			},
			"value": {
				"color": "#e1e1e1",
				"font": "verdana"
			},
			"lines": {
				"enabled": true,
				"color": "#cccccc"
			},
			"truncation": {
				"enabled": true
			}
		},
		"tooltips": { 
		},
		"effects": {
			"load": {
				"effect": "default",
				"speed":500,
			},
			"pullOutSegmentOnClick": {
				"effect": "none",
				"speed": 400,
				"size": 8
			}
		},
		"callbacks": {
			onClickSegment : function (obj) {
				window.location.href = obj["data"]["url"];
			}
		},
	});

</script> 

{% endblock %}


