{% extends 'base.html' %}

{% block title %}{{dataset.name}}  | Temporal dots{% endblock %}



{% block content %}
<div id="picture">
</div>

{% endblock %}


{% block right %}

<div>
	<h2 id="title"> </h2> 
	<p id="snippet"> </p> 
	<p id="date"> </p> 			
</div>

{% endblock %}

{% block javascript %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/static/js/d3.v3.min.js"></script>  

<script type="text/javascript">

	dates = [
		{% for month in monthes %}
			{"X": {{month.X}}, "name": "{{month.name}}"},
		{% endfor %}
	]
	
	docs = [
		{% for doc in documents %}
			{"X": {{doc.X}}, "Y": {{doc.Y}}, "title": "{{doc.document}}", "url" : "{{doc.document.url}}", "snippet" : "{{doc.document.snippet}}"},
		{% endfor %}
	]
	
	topics = [
		{% for topic in topics %}
			{"Y": {{topic.Y}}, "name": "{{topic.topic}}"},
		{% endfor %}
	]
	
	//Width and height
	var w = 1200;
	var h = 440;
	
	var topic_label_width = 150;
	 
	
	//Create SVG element
	var svg = d3.select("#picture")
				.append("svg")
				.attr("width", w)
				.attr("height", h);
				
	var g1 = svg.append("g");
	var g2 = svg.append("g");
	
	var circles = svg.selectAll("circle")
		.data(docs)
		.enter()
		.append("circle");
		

	circles.attr("cx", function(d, i) {
				return topic_label_width+20*d["X"];
		})
		.attr("cy", function(d, i) {
			return 40+20*d["Y"];
		})
		.attr("r", 3)
		.on("mouseover", function(d, i) {
			 d3.select(this)
			   .attr("r", 5)
			   .attr("fill", "red");
			document.getElementById("title").innerHTML = d["title"];
			document.getElementById("snippet").innerHTML = d["title"];
			document.getElementById("date").innerHTML = getDate(d);
			
		})
		.on("mouseout", function(d, i) {
			 d3.select(this)
			   .attr("r", 3)
			   .attr("fill", "black");
		})
		.on("click", function(d, i) {
			window.open(d["url"],'_blank');
		});
		
	var date_labels = g1.selectAll("text")
		.data(dates)
		.enter()
		.append("text")
		.attr("x", function(d) {
			return topic_label_width+20*d["X"];
		})
	   .attr("y", 20)
	   .text(function(d,i) {
			if (i%5 == 0) {
			   return d["name"];
			}  
		});

	var topic_labels = g2.selectAll('text')
		.data(topics) 	 
		.enter()
		.append('text')
		.attr("x", 0)
		.attr("y", function(d) {
			return 53+20*d["Y" ];
		})
		.text(function(d, i) {
			return d["name"];
		});
		
		 
	 
	var monthes = ["Январь", "Февраль", "Март", "Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];
	function getDate(d) {
		return monthes[parseInt(d["month"])-1] + " " + d["year"];
	}
	

</script>
		
{% endblock %}
 